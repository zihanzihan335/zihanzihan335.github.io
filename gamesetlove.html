<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game. Set. Love.</title>
    <style>
        
        :root {
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #000000;
            --text-sub: #6e6e73;
            --primary-grad: linear-gradient(135deg, #ff416c, #ff4b2b);
            --nav-height: 80px; 
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: var(--text-main);
        }

        
        header {
            text-align: center;
            padding: 15px 0;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            z-index: 100;
            flex-shrink: 0;
        }
        .app-title {
            font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px;
            background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 0;
        }

        
        .tab-content {
            flex: 1;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 100px; /* Space for nav */
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .tab-content.active { display: block; opacity: 1; }

       
        
       
        .card-wrapper {
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        
        .main-card {
            width: 100%; max-width: 420px;
            height: 450px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            display: flex;
        }

        .photo-half { width: 50%; height: 100%; position: relative; }
        .photo-half img { width: 100%; height: 100%; object-fit: cover; object-position: top; }
        .divider { position: absolute; left: 50%; width: 2px; height: 100%; background: white; z-index: 5; opacity: 0.8; }

        .card-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, transparent 100%);
            padding: 50px 20px 20px;
            color: white; z-index: 10; pointer-events: none;
        }
        .overlay-names { font-size: 1.5rem; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.4); }
        .overlay-sub { font-size: 0.9rem; opacity: 0.9; margin-top: 4px; }

        /* Action Buttons */
        .action-row {
            display: flex; justify-content: center; gap: 40px; margin-bottom: 25px;
        }
        .circle-btn {
            width: 64px; height: 64px; border-radius: 50%;
            background: white; border: none;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            font-size: 1.8rem; cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center;
        }
        .circle-btn:active { transform: scale(0.9); }
        .btn-x { color: #eb4d4b; }
        .btn-heart { background: var(--primary-grad); color: white; box-shadow: 0 8px 25px rgba(255, 75, 106, 0.4); }

       
        .info-container {
            max-width: 500px; margin: 0 auto; padding: 0 20px;
        }

        .content-box {
            background: white; border-radius: 18px; padding: 24px;
            margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }
        
        .box-label {
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.2px;
            color: #888; margin-bottom: 12px; font-weight: 600;
        }

        .story-text {
            font-family: Georgia, 'Times New Roman', Times, serif;
            font-size: 1.05rem; line-height: 1.6; color: #333;
        }

        .bio-item {
            display: flex; gap: 16px; margin-bottom: 20px;
            padding-bottom: 20px; border-bottom: 1px solid #f0f0f0;
        }
        .bio-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .bio-avatar { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex-shrink: 0;}
        .bio-content h4 { margin: 0 0 4px 0; font-size: 1rem; }
        .bio-desc { font-size: 0.85rem; color: #666; line-height: 1.4; }

 
        .matches-list { padding: 20px; max-width: 600px; margin: 0 auto; }
        
        .match-row {
            background: white; border-radius: 16px; padding: 15px;
            margin-bottom: 15px; display: flex; align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            cursor: pointer; /* Clickable */
            transition: background 0.2s;
        }
        .match-row:active { background: #f9f9f9; transform: scale(0.98); }

        .avatars-overlap { display: flex; margin-right: 15px; }
        .avatars-overlap img {
            width: 48px; height: 48px; border-radius: 50%; object-fit: cover;
            border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .avatars-overlap img:nth-child(2) { margin-left: -18px; }

        .row-info { flex: 1; min-width: 0; }
        .row-names { font-weight: 700; font-size: 1rem; margin-bottom: 2px; }
        .row-date { font-size: 0.75rem; color: #999; }
        
        .delete-btn {
            padding: 10px; border: none; background: transparent;
            color: #d1d1d6; font-size: 1.2rem; cursor: pointer;
        }
        .delete-btn:hover { color: #ff3b30; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1000;
            display: none; justify-content: center; align-items: flex-end;
        }
        .modal-overlay.open { display: flex; animation: fadeIn 0.3s; }

        .modal-card {
            width: 100%; max-width: 500px; height: 92vh;
            background: #f2f2f7; border-top-left-radius: 24px; border-top-right-radius: 24px;
            overflow-y: auto; position: relative;
            animation: slideUp 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .close-modal-btn {
            position: absolute; top: 15px; right: 15px;
            width: 36px; height: 36px; border-radius: 50%;
            background: rgba(0,0,0,0.5); color: white; border: none;
            font-size: 1.2rem; cursor: pointer; z-index: 20;
            display: flex; align-items: center; justify-content: center;
        }


        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: var(--nav-height);
            background: white; border-top: 1px solid #eee;
            display: flex; justify-content: space-around; align-items: center;
            padding-bottom: 10px; z-index: 500;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            color: #c7c7cc; text-decoration: none; font-size: 0.7rem; font-weight: 500;
            width: 50%; cursor: pointer;
        }
        .nav-item svg { width: 26px; height: 26px; margin-bottom: 4px; fill: currentColor; }
        .nav-item.active { color: #ff4b2b; }

 
        .loader {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: white; z-index: 20; display: flex; justify-content: center; align-items: center; flex-direction: column;
        }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <header>
        <h1 class="app-title">Game. Set. Love.</h1>
    </header>

    <div id="tab-discover" class="tab-content active">
        
        <div class="card-wrapper">
            <div class="main-card">
                <div class="loader" id="loader"><span>Finding Match...</span></div>
                <div class="photo-half"><img id="d-img1" src=""></div>
                <div class="divider"></div>
                <div class="photo-half"><img id="d-img2" src=""></div>
                <div class="card-overlay">
                    <h2 class="overlay-names" id="d-names"></h2>
                    <p class="overlay-sub" id="d-teams"></p>
                </div>
            </div>
        </div>

        <div class="action-row">
            <button class="circle-btn btn-x" onclick="nextPair()">✕</button>
            <button class="circle-btn btn-heart" onclick="saveCurrent()">♥︎</button>
        </div>

        <div class="info-container">
            <div class="content-box">
                <div class="box-label">The Story</div>
                <div class="story-text" id="d-story"></div>
            </div>

            <div class="content-box">
                <div class="box-label">The Athletes</div>
                <div class="bio-item">
                    <img id="d-bio-img1" class="bio-avatar" src="">
                    <div class="bio-content">
                        <h4 id="d-bio-name1"></h4>
                        <div class="bio-desc" id="d-bio-desc1"></div>
                    </div>
                </div>
                <div class="bio-item">
                    <img id="d-bio-img2" class="bio-avatar" src="">
                    <div class="bio-content">
                        <h4 id="d-bio-name2"></h4>
                        <div class="bio-desc" id="d-bio-desc2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-saved" class="tab-content">
        <div class="matches-list" id="matches-list">
            </div>
        <div style="text-align:center; padding: 20px;">
            <button onclick="clearAll()" style="background:none; border:none; color:#999; text-decoration:underline;">Reset History</button>
        </div>
    </div>

    <div class="modal-overlay" id="detail-modal">
        <div class="modal-card">
            <button class="close-modal-btn" onclick="closeModal()">✕</button>
            
            <div class="card-wrapper">
                <div class="main-card" style="height: 350px;">
                    <div class="photo-half"><img id="m-img1" src=""></div>
                    <div class="divider"></div>
                    <div class="photo-half"><img id="m-img2" src=""></div>
                    <div class="card-overlay">
                        <h2 class="overlay-names" id="m-names"></h2>
                        <p class="overlay-sub" id="m-teams"></p>
                    </div>
                </div>
            </div>

            <div class="info-container">
                <div class="content-box">
                    <div class="box-label">The Archive</div>
                    <div class="story-text" id="m-story"></div>
                </div>
                
                <div class="content-box">
                    <div class="box-label">The Athletes</div>
                    <div class="bio-item">
                        <img id="m-bio-img1" class="bio-avatar" src="">
                        <div class="bio-content">
                            <h4 id="m-bio-name1"></h4>
                            <div class="bio-desc" id="m-bio-desc1"></div>
                        </div>
                    </div>
                    <div class="bio-item">
                        <img id="m-bio-img2" class="bio-avatar" src="">
                        <div class="bio-content">
                            <h4 id="m-bio-name2"></h4>
                            <div class="bio-desc" id="m-bio-desc2"></div>
                        </div>
                    </div>
                </div>
                <div style="height: 50px;"></div> </div>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="setTab('discover', this)">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.49L17.5 6.5 9.99 9.99 6.5 17.5zm5.5-6.6c.61 0 1.1.49 1.1 1.1s-.49 1.1-1.1 1.1-1.1-.49-1.1-1.1.49-1.1 1.1-1.1z"/></svg>
            Discover
        </div>
        <div class="nav-item" onclick="setTab('saved', this)">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            Favorites
        </div>
    </nav>

    <script>
    
        const TEAMS = [
    'Los_Angeles_Lakers', 
    'New_York_Yankees', 
    'Miami_Heat', 
    'Golden_State_Warriors'];
        let playerPool = [];
        let currentPair = null;
        let isFetching = false;

        
        window.onload = async () => {
            loadSavedMatches();
            await fetchPool();
            nextPair();
        }

        // API and data fetching
        async function fetchPool() {
            if(playerPool.length > 50) return;
            const t1 = TEAMS[Math.floor(Math.random() * TEAMS.length)];
            const t2 = TEAMS[Math.floor(Math.random() * TEAMS.length)];
            await getPlayers(t1);
            if(t1 !== t2) await getPlayers(t2);
        }

        async function getPlayers(team) {
            try {
                const res = await fetch(`https://www.thesportsdb.com/api/v1/json/3/searchplayers.php?t=${team}`);
                const json = await res.json();
                if(json.player) {
                    //keep players with photos
                    const clean = json.player.filter(p => p.strThumb && p.strThumb !== "");
                    playerPool = [...playerPool, ...clean];
                }
            } catch(e) { console.log(e); }
        }

        // --- CORE LOGIC ---
        function nextPair() {
            if(playerPool.length < 2) {
                // If pool is empty/failed, retry fetch
                fetchPool().then(() => {
                    if(playerPool.length > 1) nextPair();
                    else document.getElementById('loader').innerText = "Network Error. Refresh.";
                });
                return;
            }

            document.getElementById('loader').style.display = 'flex';
            
            
            setTimeout(() => {
                let p1 = playerPool[Math.floor(Math.random() * playerPool.length)];
                let p2 = playerPool[Math.floor(Math.random() * playerPool.length)];
                while(p1.idPlayer === p2.idPlayer) {
                    p2 = playerPool[Math.floor(Math.random() * playerPool.length)];
                }

                
                const story = generateStory(p1, p2);
                const bio1 = generateSmartBio(p1);
                const bio2 = generateSmartBio(p2);

                currentPair = {
                    id: Date.now(),
                    p1: p1,
                    p2: p2,
                    story: story,
                    bio1: bio1,
                    bio2: bio2
                };

                updateDiscoverUI(currentPair);
                document.getElementById('loader').style.display = 'none';
                
                // Scroll top
                document.getElementById('tab-discover').scrollTo(0,0);
            }, 500);
        }

       // Simple bio generator
        function generateSmartBio(p) {
            // Priority 1: Use actual API bio if it exists and is decent length
            if (p.strDescriptionEN && p.strDescriptionEN.length > 20) {
                return p.strDescriptionEN.substring(0, 180) + (p.strDescriptionEN.length>180?"...":"");
            }
            

            
            const sport = p.strSport || "Professional Sports";
            const team = p.strTeam || "their team";
            const pos = p.strPosition || "Athlete";
            
            const templates = [
                `${p.strPlayer} is a professional ${sport} player representing ${team}. Known for their dedication as a ${pos}, they have become a fan favorite.`,
                `Playing as a ${pos} for ${team}, ${p.strPlayer} has shown incredible skill in ${sport} and continues to impress on the world stage.`,
                `A key member of ${team}, ${p.strPlayer} brings energy and talent to the ${sport} field.`
            ];
            return templates[Math.floor(Math.random() * templates.length)];
        }

        function generateStory(p1, p2) {
            const locs = ["Brooklyn Bridge Park", "a jazz club in Bed-Stuy", "the rooftop of the 1 Hotel", "Domino Park"];
            const loc = locs[Math.floor(Math.random() * locs.length)];
            
            return `
                It was an unlikely encounter at <b>${loc}</b>. 
                ${p1.strPlayer}, fresh from training with ${p1.strTeam}, bumped into ${p2.strPlayer}. 
                <br><br>
                What started as a polite apology turned into a three-hour conversation about the pressures of elite sports. 
                As the NYC skyline lit up, they realized they shared more than just a profession—they shared a rhythm.
                <br><br>
                Game. Set. Love.
            `;
        }

        // UI
        function updateDiscoverUI(data) {
            // Images
            document.getElementById('d-img1').src = data.p1.strThumb;
            document.getElementById('d-img2').src = data.p2.strThumb;
            // Text
            document.getElementById('d-names').innerText = `${data.p1.strPlayer} & ${data.p2.strPlayer}`;
            document.getElementById('d-teams').innerText = `${data.p1.strTeam} | ${data.p2.strTeam}`;
            document.getElementById('d-story').innerHTML = data.story;
            // Bios
            document.getElementById('d-bio-img1').src = data.p1.strThumb;
            document.getElementById('d-bio-name1').innerText = data.p1.strPlayer;
            document.getElementById('d-bio-desc1').innerText = data.bio1;

            document.getElementById('d-bio-img2').src = data.p2.strThumb;
            document.getElementById('d-bio-name2').innerText = data.p2.strPlayer;
            document.getElementById('d-bio-desc2').innerText = data.bio2;
        }

        function updateModalUI(data) {
            document.getElementById('m-img1').src = data.p1.strThumb;
            document.getElementById('m-img2').src = data.p2.strThumb;
            document.getElementById('m-names').innerText = `${data.p1.strPlayer} & ${data.p2.strPlayer}`;
            document.getElementById('m-teams').innerText = `${data.p1.strTeam} | ${data.p2.strTeam}`;
            document.getElementById('m-story').innerHTML = data.story;
            
            document.getElementById('m-bio-img1').src = data.p1.strThumb;
            document.getElementById('m-bio-name1').innerText = data.p1.strPlayer;
            document.getElementById('m-bio-desc1').innerText = data.bio1;

            document.getElementById('m-bio-img2').src = data.p2.strThumb;
            document.getElementById('m-bio-name2').innerText = data.p2.strPlayer;
            document.getElementById('m-bio-desc2').innerText = data.bio2;
        }

        // --- SAVING & MODAL LOGIC ---
        function saveCurrent() {
            let matches = JSON.parse(localStorage.getItem('gsl_matches') || "[]");
            matches.unshift(currentPair); // Add to top
            localStorage.setItem('gsl_matches', JSON.stringify(matches));
            
            loadSavedMatches();
            
            // Heart Animation
            const btn = document.querySelector('.btn-heart');
            btn.style.transform = "scale(1.3)";
            setTimeout(() => btn.style.transform = "scale(1)", 200);
            
            nextPair();
        }

        function loadSavedMatches() {
            const matches = JSON.parse(localStorage.getItem('gsl_matches') || "[]");
            const list = document.getElementById('matches-list');
            
            if(matches.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#999; margin-top:40px;">No saved stories yet.</div>';
                return;
            }

            let html = '';
            matches.forEach((m, index) => {
                // Note: We pass the index to openModal to find the data easily
                html += `
                <div class="match-row" onclick="openModal(${index})">
                    <div class="avatars-overlap">
                        <img src="${m.p1.strThumb}">
                        <img src="${m.p2.strThumb}">
                    </div>
                    <div class="row-info">
                        <div class="row-names">${m.p1.strPlayer} & ${m.p2.strPlayer}</div>
                        <div class="row-date">Saved just now</div>
                    </div>
                    <button class="delete-btn" onclick="deleteMatch(event, ${index})">✕</button>
                </div>
                `;
            });
            list.innerHTML = html;
        }

        function openModal(index) {
            const matches = JSON.parse(localStorage.getItem('gsl_matches') || "[]");
            if(!matches[index]) return;
            
            updateModalUI(matches[index]);
            
            const modal = document.getElementById('detail-modal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('open'), 10);
        }

        function closeModal() {
            const modal = document.getElementById('detail-modal');
            modal.classList.remove('open');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        function deleteMatch(e, index) {
            e.stopPropagation(); // Stop clicking the row from opening modal
            let matches = JSON.parse(localStorage.getItem('gsl_matches') || "[]");
            matches.splice(index, 1);
            localStorage.setItem('gsl_matches', JSON.stringify(matches));
            loadSavedMatches();
        }

        function clearAll() {
            if(confirm("Clear history?")) {
                localStorage.removeItem('gsl_matches');
                loadSavedMatches();
            }
        }

        
        function setTab(tab, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

    </script>
</body>
</html>
